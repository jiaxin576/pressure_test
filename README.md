# pressure_test
服务器压力测试
![image](https://github.com/user-attachments/assets/68619fc5-ea91-4813-a1de-0f7e9659876c)

1 压测核心目标

是 “在单位时间内，以尽可能小的资源消耗，模拟出海量的、符合业务场景的请求”。压测工具通过创建“虚拟用户”来模拟真实用户。生成这些虚拟用户主要有两种模式：

A. 基于线程模型

原理：一个线程 = 一个虚拟用户。例如，要模拟100个并发用户，压测工具就会在其所在的机器上创建100个线程。
缺点：资源消耗大。每个线程都需要消耗操作系统的内存和CPU调度资源。一台压测机通常只能模拟几百到上千个线程，再多就会因为自身资源瓶颈（CPU上下文切换、内存不足）导致压测结果不准。
典型工具：Apache JMeter, LoadRunner。
B. 基于事件驱动/异步I/O模型

原理：它不为每个用户创建一个线程，而是使用一个或少数几个核心线程来处理成千上万的网络连接。其核心是利用操作系统的非阻塞I/O和I/O多路复用技术（如Linux的epoll，macOS的kqueue）。
缺点：脚本编写相对复杂，需要理解异步编程的概念（如回调、Promise、async/await）。
典型工具：k6 (Gatling), Locust, Vegeta。

2 如何确定支持的并发数
并发数本身是一个没有意义的孤立数字。有意义的说法是：“在P99响应时间低于500ms，且错误率低于0.1%的前提下，系统能稳定支持每秒800个请求（RPS），这时的并发用户数大约是1000人。”

定义性能验收标准：

响应时间：例如，P95（95%的请求）响应时间必须在200ms以内。
吞吐量：系统每秒至少要能处理1000个请求（RPS/QPS）。
错误率：错误率必须低于0.1%。
执行阶梯式加压测试：

从一个很低的并发数开始，比如 20 并发。
运行3-5分钟，记录该并发数下的 RPS、平均响应时间、P95/P99响应时间、错误率，以及服务器的CPU/内存使用率。
增加并发数，比如到 50 并发，重复上一步。
继续增加，100、200、300、500...
寻找性能拐点：
将收集到的数据绘制成图表，X轴是并发数，Y轴是RPS和响应时间。

理想区：一开始，随着并发数增加，RPS（吞吐量）几乎呈线性增长，而响应时间变化不大。这是系统的“舒适区”。
拐点：当并发数达到某个点时，RPS的增长开始放缓，而响应时间开始明显上升。这个点就是性能拐点。
饱和区/崩溃区：继续增加并发数，RPS不再增长甚至开始下降，同时响应时间急剧恶化，错误率开始飙升。这说明系统已经过载。


3 测试log记录如下所示

20:21:19,925 - MainThread - INFO - 等待 5 秒后进入下一阶段...
20:21:24,930 - MainThread - INFO - ================================================================================
20:21:24,931 - MainThread - INFO - 开始测试阶段: 并发数 = 8, 持续时间 = 0.2 分钟, 模型 = 豆包大模型
20:21:24,931 - MainThread - INFO - ================================================================================
20:21:33,136 - Worker-C8_6 - INFO - 请求成功 - 耗时: 8.19s - 输入: "你好，请介绍一下你自己..."
20:21:38,546 - Worker-C8_2 - INFO - 请求成功 - 耗时: 13.61s - 输入: "给我讲一个关于程序员的笑话..."
20:21:39,480 - Worker-C8_6 - INFO - 请求成功 - 耗时: 6.34s - 输入: "北京今天的天气怎么样？..."
20:21:42,344 - Worker-C8_7 - INFO - 请求成功 - 耗时: 17.40s - 输入: "给我讲一个关于程序员的笑话..."
20:21:50,260 - Worker-C8_4 - INFO - 请求成功 - 耗时: 25.32s - 输入: "解释一下什么是“人工智能”..."
20:21:52,284 - Worker-C8_0 - INFO - 请求成功 - 耗时: 27.35s - 输入: "如何用Python实现一个快速排序算法？..."
20:21:53,316 - Worker-C8_3 - INFO - 请求成功 - 耗时: 28.38s - 输入: "给我讲一个关于程序员的笑话..."
20:21:56,664 - Worker-C8_5 - INFO - 请求成功 - 耗时: 31.72s - 输入: "解释一下什么是“人工智能”..."
20:21:58,678 - Worker-C8_1 - INFO - 请求成功 - 耗时: 33.74s - 输入: "解释一下什么是“人工智能”..."
20:21:58,680 - MainThread - INFO - ================================================================================
20:21:58,681 - MainThread - INFO - 测试阶段结束: 并发数 = 8
20:21:58,681 - MainThread - INFO - 总请求数: 9
20:21:58,681 - MainThread - INFO -   - 成功: 9 | 失败: 0 | 异常: 0
20:21:58,681 - MainThread - INFO - 成功率: 100.00%
20:21:58,681 - MainThread - INFO - 请求/秒 (RPS): 0.75
20:21:58,683 - MainThread - INFO - -------------------- 成功请求响应时间 (秒) --------------------
20:21:58,684 - MainThread - INFO - 平均值: 21.338 | 最小值: 6.342 | 最大值: 33.743
20:21:58,684 - MainThread - INFO - P95: 32.933 | P99: 33.581
20:21:58,684 - MainThread - INFO - ================================================================================

20:21:58,684 - MainThread - INFO - 所有测试阶段完成！
20:22:00,213 - MainThread - INFO - 测试结果图表已保存至: pressure_test_results.png
